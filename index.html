<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeChat Keyword Evasion Scrambler</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- Utilities ---
        const ZWSP = "\u200B"; // zero width space
        const ZWNJ = "\u200C"; // zero width non-joiner
        const ZWJ = "\u200D"; // zero width joiner

        const COMBINING_MARKS = [
          "\u0301", // acute
          "\u0300", // grave
          "\u0308", // diaeresis
          "\u0303", // tilde
          "\u0302", // circumflex
        ];

        // Map of Latin -> array of homoglyph choices (Greek/Cyrillic lookalikes)
        const HOMOGLYPHS = {
          A: ["Α", "А"], // Greek Alpha, Cyrillic A
          a: ["а", "α"],
          B: ["Β", "В"],
          E: ["Ε", "Е"],
          e: ["е", "ε"],
          H: ["Η", "Н"],
          I: ["Ι", "І"],
          i: ["і", "ι"],
          K: ["Κ", "К"],
          M: ["Μ", "М"],
          N: ["Ν", "N"], // Greek Nu looks like N
          O: ["Ο", "О"],
          o: ["ο", "о"],
          P: ["Ρ", "Р"],
          p: ["ρ", "р"],
          C: ["Ϲ", "С"],
          c: ["ϲ", "с"],
          T: ["Τ", "Т"],
          X: ["Χ", "Х"],
          Y: ["Υ", "Ү"],
        };

        const LEET = {
          a: ["@", "4"],
          e: ["3"],
          i: ["1", "!"],
          o: ["0"],
          s: ["$", "5"],
          t: ["7"],
        };

        // lightweight RNG with seed option
        function mulberry32(seed) {
          return function () {
            let t = (seed += 0x6d2b79f5);
            t = Math.imul(t ^ (t >>> 15), t | 1);
            t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
            return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
          };
        }

        function pick(rng, arr) {
          return arr[Math.floor(rng() * arr.length)];
        }

        function withProbability(rng, p) {
          return rng() < p;
        }

        // --- Transformations ---
        function insertZeroWidth(input, rng, density = 0.25) {
          const zwChars = [ZWSP, ZWNJ, ZWJ];
          let out = "";
          for (let i = 0; i < input.length; i++) {
            const ch = input[i];
            out += ch;
            if (/\w/.test(ch) && withProbability(rng, density)) {
              out += pick(rng, zwChars);
            }
          }
          return out;
        }

        function applyHomoglyphs(input, rng, density = 0.3) {
          let out = "";
          for (const ch of input) {
            const choices = HOMOGLYPHS[ch];
            if (choices && withProbability(rng, density)) {
              out += pick(rng, choices);
            } else {
              out += ch;
            }
          }
          return out;
        }

        function splitCharacters(input, rng, separators = [".", "*", " "]) {
          // Only split alphanumerics; keep words readable-ish
          return input
            .split(/(\s+)/)
            .map((token) => {
              if (/^\s+$/.test(token)) return token; // leave whitespace chunks
              const sep = pick(rng, separators);
              return token.split("").join(sep);
            })
            .join("");
        }

        function applyLeet(input, rng, density = 0.35) {
          let out = "";
          for (const ch of input) {
            const base = ch.toLowerCase();
            const choices = LEET[base];
            if (choices && withProbability(rng, density)) {
              out += pick(rng, choices);
            } else {
              out += ch;
            }
          }
          return out;
        }

        function addCombiningMarks(input, rng, density = 0.25) {
          let out = "";
          for (const ch of input) {
            out += ch;
            if (/\w/.test(ch) && withProbability(rng, density)) {
              out += pick(rng, COMBINING_MARKS);
            }
          }
          return out;
        }

        function mixScripts(input, rng, density = 0.15) {
          // Insert a random CJK or Katakana character occasionally
          const extras = [
            "自", "和", "安", "田", "光", "山", // CJK common
            "ア", "カ", "サ", "タ", "ナ", "マ", "ラ", "ワ", // Katakana
          ];
          let out = "";
          for (const ch of input) {
            out += ch;
            if (/\w/.test(ch) && withProbability(rng, density)) {
              out += pick(rng, extras);
            }
          }
          return out;
        }

        // Pipeline
        function scramble(text, opts) {
          const seedNum = opts.seed ? hashString(opts.seed) : Math.floor(Math.random() * 1e9);
          const rng = mulberry32(seedNum);

          let out = text;

          if (opts.useHomoglyphs) out = applyHomoglyphs(out, rng, 0.35);
          if (opts.useLeet) out = applyLeet(out, rng, 0.35);
          if (opts.useCombining) out = addCombiningMarks(out, rng, 0.25);
          if (opts.useZeroWidth) out = insertZeroWidth(out, rng, 0.3);
          if (opts.useMixScripts) out = mixScripts(out, rng, 0.12);
          if (opts.useSplit) out = splitCharacters(out, rng, parseSeparators(opts.splitSeparators));

          return out;
        }

        function hashString(s) {
          let h = 2166136261 >>> 0; // FNV-1a
          for (let i = 0; i < s.length; i++) {
            h ^= s.charCodeAt(i);
            h = Math.imul(h, 16777619);
          }
          return h >>> 0;
        }

        function parseSeparators(raw) {
          const list = raw
            .split(",")
            .map((x) => x.trim())
            .filter(Boolean);
          return list.length ? list : [".", "*", " "];
        }

        function EvasionScrambler() {
          const [input, setInput] = useState("Type your message here…");
          const [output, setOutput] = useState("");
          const [copied, setCopied] = useState(false);
          const [isFirstFocus, setIsFirstFocus] = useState(true);

          const [opts, setOpts] = useState({
            useZeroWidth: true,
            useHomoglyphs: true,
            useSplit: false,
            useLeet: false,
            useCombining: true,
            useMixScripts: false,
            seed: "",
            splitSeparators: ".,*, ",
          });

          const charDelta = useMemo(() => Math.max(0, output.length - input.length), [input, output]);

          function run() {
            setCopied(false);
            const result = scramble(input, opts);
            setOutput(result);
          }

          function handleInputFocus() {
            if (isFirstFocus && input === "Type your message here…") {
              setInput("");
              setIsFirstFocus(false);
            }
          }

          function handleInputChange(e) {
            setInput(e.target.value);
            if (isFirstFocus) {
              setIsFirstFocus(false);
            }
          }

          function clearInput() {
            setInput("");
            setIsFirstFocus(false);
          }

          async function copyOut() {
            try {
              await navigator.clipboard.writeText(output);
              setCopied(true);
              setTimeout(() => setCopied(false), 1500);
            } catch (e) {
              console.error(e);
            }
          }

          return React.createElement('div', { className: "min-h-screen w-full bg-neutral-50 text-neutral-900" },
            React.createElement('div', { className: "max-w-4xl mx-auto p-4 sm:p-6" },
              React.createElement('h1', {
                className: "text-xl sm:text-2xl lg:text-3xl font-semibold tracking-tight mb-2 text-center sm:text-left"
              }, "WeChat Keyword Evasion Scrambler"),
              React.createElement('p', { className: "hidden sm:block text-xs sm:text-sm text-neutral-600 mb-4 sm:mb-6 text-center sm:text-left leading-relaxed" },
                "⚠️ For reducing basic keyword flags only. This does not provide real privacy. For sensitive topics, use end‑to‑end encryption and consider steganography."
              ),

              React.createElement('div', { className: "grid lg:grid-cols-2 gap-4 sm:gap-6" },
                React.createElement('div', { className: "space-y-3 order-2 lg:order-1" },
                  React.createElement('div', { className: "flex items-center justify-between" },
                    React.createElement('label', { className: "text-sm font-medium" }, "Input"),
                    React.createElement('button', {
                      onClick: clearInput,
                      className: "text-xs text-neutral-500 hover:text-neutral-700 px-2 py-1 rounded-lg hover:bg-neutral-100"
                    }, "Clear")
                  ),
                  React.createElement('textarea', {
                    value: input,
                    onChange: handleInputChange,
                    onFocus: handleInputFocus,
                    className: "w-full h-32 sm:h-48 rounded-2xl border border-neutral-200 p-3 sm:p-4 focus:outline-none focus:ring-2 focus:ring-neutral-800 bg-white shadow-sm text-sm sm:text-base",
                    placeholder: "Type your message here…"
                  }),

                  React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 bg-white rounded-2xl p-3 sm:p-4 border border-neutral-200 shadow-sm" },
                    React.createElement(Toggle, {
                      label: "Zero‑width chars",
                      checked: opts.useZeroWidth,
                      onChange: (v) => setOpts({ ...opts, useZeroWidth: v })
                    }),
                    React.createElement(Toggle, {
                      label: "Homoglyphs",
                      checked: opts.useHomoglyphs,
                      onChange: (v) => setOpts({ ...opts, useHomoglyphs: v })
                    }),
                    React.createElement(Toggle, {
                      label: "Split characters",
                      checked: opts.useSplit,
                      onChange: (v) => setOpts({ ...opts, useSplit: v })
                    }),
                    React.createElement(Toggle, {
                      label: "Leetspeak",
                      checked: opts.useLeet,
                      onChange: (v) => setOpts({ ...opts, useLeet: v })
                    }),
                    React.createElement(Toggle, {
                      label: "Combining marks",
                      checked: opts.useCombining,
                      onChange: (v) => setOpts({ ...opts, useCombining: v })
                    }),
                    React.createElement(Toggle, {
                      label: "Mix scripts",
                      checked: opts.useMixScripts,
                      onChange: (v) => setOpts({ ...opts, useMixScripts: v })
                    }),

                    React.createElement('div', { className: "col-span-1 sm:col-span-2" },
                      React.createElement('label', { className: "text-xs text-neutral-600" }, "Split separators (comma‑separated)"),
                      React.createElement('input', {
                        value: opts.splitSeparators,
                        onChange: (e) => setOpts({ ...opts, splitSeparators: e.target.value }),
                        className: "mt-1 w-full rounded-xl border border-neutral-200 p-2 sm:p-2 focus:outline-none focus:ring-2 focus:ring-neutral-800 text-sm"
                      })
                    ),

                    React.createElement('div', { className: "col-span-1 sm:col-span-2" },
                      React.createElement('label', { className: "text-xs text-neutral-600" }, "Seed (optional for reproducible output)"),
                      React.createElement('input', {
                        value: opts.seed,
                        onChange: (e) => setOpts({ ...opts, seed: e.target.value }),
                        className: "mt-1 w-full rounded-xl border border-neutral-200 p-2 sm:p-2 focus:outline-none focus:ring-2 focus:ring-neutral-800 text-sm",
                        placeholder: "Leave blank for random"
                      })
                    )
                  ),

                  React.createElement('div', { className: "flex flex-col sm:flex-row gap-2 sm:gap-3" },
                    React.createElement('button', {
                      onClick: run,
                      className: "px-4 py-3 sm:py-2 rounded-2xl bg-neutral-900 text-white shadow hover:shadow-md active:scale-[.99] text-sm sm:text-base font-medium"
                    }, "Scramble"),
                    React.createElement('button', {
                      onClick: () => setOpts({
                        useZeroWidth: true,
                        useHomoglyphs: true,
                        useSplit: false,
                        useLeet: false,
                        useCombining: true,
                        useMixScripts: false,
                        seed: "",
                        splitSeparators: ".,*, ",
                      }),
                      className: "px-4 py-3 sm:py-2 rounded-2xl bg-white border border-neutral-300 text-neutral-900 shadow-sm hover:shadow text-sm sm:text-base font-medium"
                    }, "Reset options")
                  )
                ),

                React.createElement('div', { className: "space-y-3 order-1 lg:order-2" },
                  React.createElement('label', { className: "text-sm font-medium flex items-center gap-2" },
                    "Output",
                    output && React.createElement('span', { className: "ml-2 text-xs text-neutral-500" }, `(+${charDelta} chars)`)
                  ),
                  React.createElement('textarea', {
                    value: output,
                    readOnly: true,
                    className: "w-full h-40 sm:h-64 rounded-2xl border border-neutral-200 p-3 sm:p-4 bg-neutral-50 shadow-inner text-sm sm:text-base",
                    placeholder: "Your scrambled message will appear here…"
                  }),
                  React.createElement('div', { className: "flex flex-col sm:flex-row gap-2 sm:gap-3" },
                    React.createElement('button', {
                      onClick: copyOut,
                      disabled: !output,
                      className: "px-4 py-3 sm:py-2 rounded-2xl bg-neutral-900 text-white shadow hover:shadow-md disabled:opacity-40 text-sm sm:text-base font-medium"
                    }, copied ? "Copied!" : "Copy"),
                    React.createElement('button', {
                      onClick: () => setOutput(""),
                      className: "px-4 py-3 sm:py-2 rounded-2xl bg-white border border-neutral-300 text-neutral-900 shadow-sm hover:shadow text-sm sm:text-base font-medium"
                    }, "Clear output")
                  ),

                  React.createElement('div', { className: "hidden lg:block text-xs sm:text-xs text-neutral-600 leading-relaxed bg-white rounded-2xl p-3 sm:p-4 border border-neutral-200 shadow-sm" },
                    React.createElement('p', { className: "mb-2" }, "Tips:"),
                    React.createElement('ul', { className: "list-disc ml-5 space-y-1" },
                      React.createElement('li', null, "Rotate techniques. Don't use the same pattern every time."),
                      React.createElement('li', null, "Keep messages natural‑looking to avoid human scrutiny."),
                      React.createElement('li', null, "For real privacy, move to end‑to‑end encrypted apps (e.g., Signal) and consider steganography.")
                    )
                  )
                )
              ),

              // Mobile-only sections at bottom
              React.createElement('div', { className: "lg:hidden mt-6 space-y-4" },
                // Alert section for mobile
                React.createElement('div', { className: "text-xs text-neutral-600 bg-white rounded-2xl p-3 border border-neutral-200 shadow-sm text-center" },
                  "⚠️ For reducing basic keyword flags only. This does not provide real privacy. For sensitive topics, use end‑to‑end encryption and consider steganography."
                ),
                
                // Tips section for mobile
                React.createElement('div', { className: "text-xs text-neutral-600 leading-relaxed bg-white rounded-2xl p-3 border border-neutral-200 shadow-sm" },
                  React.createElement('p', { className: "mb-2 font-medium" }, "Tips:"),
                  React.createElement('ul', { className: "list-disc ml-5 space-y-1" },
                    React.createElement('li', null, "Rotate techniques. Don't use the same pattern every time."),
                    React.createElement('li', null, "Keep messages natural‑looking to avoid human scrutiny."),
                    React.createElement('li', null, "For real privacy, move to end‑to‑end encrypted apps (e.g., Signal) and consider steganography.")
                  )
                )
              )
            )
          );
        }

        function Toggle({ label, checked, onChange }) {
          return React.createElement('button', {
            type: "button",
            onClick: () => onChange(!checked),
            className: `flex items-center justify-between w-full px-3 py-3 sm:py-2 rounded-xl border text-xs sm:text-sm shadow-sm touch-manipulation ${
              checked ? "bg-neutral-900 text-white border-neutral-900" : "bg-white border-neutral-200 text-neutral-900"
            }`
          },
            React.createElement('span', null, label),
            React.createElement('span', {
              className: `inline-block w-9 h-5 rounded-full relative transition-all ${
                checked ? "bg-white/30" : "bg-neutral-200"
              }`
            },
              React.createElement('span', {
                className: `absolute top-0.5 h-4 w-4 rounded-full bg-white transition-all ${
                  checked ? "left-4" : "left-0.5"
                }`
              })
            )
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(EvasionScrambler));
    </script>
</body>
</html>